<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RKISApp.ViewModels"
             x:Class="RKISApp.Views.RKISView"
             x:DataType="vm:RKISViewModel"
             x:Name="RKISViewControl">
	<StackPanel Margin="10">
		<!-- Верхняя панель -->
		<StackPanel Orientation="Horizontal" Margin="0,0,0,10">
			<TextBox Text="{Binding NewStudentName, Mode=TwoWay}" Width="200" Margin="0,0,10,0" Watermark="Имя студента"/>
			<ListBox ItemsSource="{Binding AvailableCourses}" SelectedItems="{Binding SelectedCourses}" SelectionMode="Multiple" Width="200" Margin="0,0,10,0">
				<ListBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Name}"/>
					</DataTemplate>
				</ListBox.ItemTemplate>
			</ListBox>
			<Button Content="{Binding EditingStudent, Converter={StaticResource EditingStudentToContentConverter}}"
                    Command="{Binding CurrentAddSaveCommand}"/>
			<Button Content="Отмена" Command="{Binding CancelEditCommand}" IsVisible="{Binding EditingStudent, Converter={StaticResource NullToBooleanConverter}}"/>
		</StackPanel>
		<!-- Список -->
		<ItemsControl ItemsSource="{Binding Students}">
			<ItemsControl.ItemTemplate>
				<DataTemplate>
					<Border BorderBrush="Gray" BorderThickness="1" Margin="0,0,0,5" Padding="5">
						<StackPanel>
							<TextBlock Text="{Binding Name}" FontWeight="Bold" IsVisible="{Binding !IsEditing}"/>
							<TextBox Text="{Binding Name, Mode=TwoWay}" Width="200" IsVisible="{Binding IsEditing}"/>
							<TextBlock Text="{Binding Courses, Converter={StaticResource CoursesToStringConverter}}" IsVisible="{Binding !IsEditing}"/>
							<ListBox ItemsSource="{Binding DataContext.AvailableCourses, ElementName=RKISViewControl}"
                                     SelectedItems="{Binding Courses, Mode=TwoWay}"
                                     SelectionMode="Multiple"
                                     Width="200"
                                     IsVisible="{Binding IsEditing}">
								<ListBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Name}"/>
									</DataTemplate>
								</ListBox.ItemTemplate>
							</ListBox>
							<StackPanel Orientation="Horizontal">
								<Button Content="Изменить" Command="{Binding DataContext.EditStudentCommand, ElementName=RKISViewControl}" CommandParameter="{Binding}" IsVisible="{Binding !IsEditing}"/>
								<Button Content="Сохранить" Command="{Binding DataContext.SaveStudentCommand, ElementName=RKISViewControl}" CommandParameter="{Binding}" IsVisible="{Binding IsEditing}"/>
								<Button Content="Удалить" Command="{Binding DataContext.RemoveStudentCommand, ElementName=RKISViewControl}" CommandParameter="{Binding}"/>
							</StackPanel>
						</StackPanel>
					</Border>
				</DataTemplate>
			</ItemsControl.ItemTemplate>
		</ItemsControl>
	</StackPanel>
</UserControl>